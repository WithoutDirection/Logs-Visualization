<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Unified Log Entry Visualization Tool</title>
    <script src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <div class="container">
        <!-- Header/Control Panel -->
        <div class="header">
            <select id="graph-selector">
                <option value="">Select Event Graph...</option>
            </select>
            <button id="load-btn" disabled>Load Graph</button>
            
            <div class="range-controls">
                <div class="window-nav-buttons">
                    <button id="last-window-btn" class="window-nav-btn" title="Previous window">‚óÄ Last</button>
                    <button id="next-window-btn" class="window-nav-btn" title="Next window">Next ‚ñ∂</button>
                </div>
                <label style="color: white; font-size: 13px;">
                    From Entry: <input type="number" id="entry-start" min="1" value="1">
                </label>
                <label style="color: white; font-size: 13px;">
                    To Entry: <input type="number" id="entry-end" min="1" value="100">
                </label>
                <button id="apply-range-btn">Apply Range</button>
            </div>
        </div>
        
        <!-- Sidebar -->
        <div class="sidebar">
            <h3>üìä Graph Statistics</h3>
            <div class="stats-grid" id="stats-container">
                <div class="stat-item">
                    <span class="stat-label">Nodes:</span>
                    <span class="stat-value" id="stat-nodes">-</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Edges:</span>
                    <span class="stat-value" id="stat-edges">-</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Entries:</span>
                    <span class="stat-value" id="stat-entries">-</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Time Range:</span>
                    <span class="stat-value" id="stat-time">-</span>
                </div>
            </div>
            
            <h3>üéõÔ∏è Visualization Options</h3>
            <div class="filter-section">
                <div class="filter-group">
                    <label>
                        <input type="checkbox" id="sequence-grouping" checked>
                        Enable Sequence Grouping
                    </label>
                    <label>
                        <input type="checkbox" id="reapr-analysis">
                        Show REAPr Analysis
                    </label>
                    <label>
                        <input type="checkbox" id="show-legend">
                        Show Legend
                    </label>
                    <label>
                        <input type="checkbox" id="optimize-registry-paths" checked title="Automatically shorten long registry paths by replacing common prefixes with '~'. Select nodes to see full paths.">
                        Optimize Registry Paths
                    </label>
                </div>
            </div>
            
            <h3>üìã Entry Range Presets</h3>
            <div class="preset-controls">
                <button class="preset-btn" data-range="10">First 10</button>
                <button class="preset-btn" data-range="25">First 25</button>
                <button class="preset-btn" data-range="50">First 50</button>
                <button class="preset-btn" data-range="100">First 100</button>
                <button class="preset-btn" data-range="250">First 250</button>
                <button class="preset-btn" data-range="500">First 500</button>
                <button class="preset-btn" data-range="all">All Entries</button>
            </div>
            
            <h3>üîç Node Type Filters</h3>
            <div class="filter-section" id="node-filters">
                <div class="filter-group">
                    <label>
                        <input type="checkbox" id="show-process" checked>
                        Process Nodes
                    </label>
                    <label>
                        <input type="checkbox" id="show-file" checked>
                        File Nodes
                    </label>
                    <label>
                        <input type="checkbox" id="show-registry" checked>
                        Registry Nodes
                    </label>
                    <label>
                        <input type="checkbox" id="show-network" checked>
                        Network Nodes
                    </label>
                </div>
            </div>
            
            <h3>üéØ Pattern Settings</h3>
            <div class="filter-section" id="pattern-filters">
                <div class="slider-container">
                    <label>Confidence Threshold: <span id="confidence-value">60%</span></label>
                    <input type="range" id="confidence-slider" class="slider" min="0" max="100" value="60">
                </div>
            </div>
            
            <h3>‚öôÔ∏è Layout Options</h3>
            <div class="filter-section">
                <div class="filter-group">
                    <label>
                        <input type="checkbox" id="enable-physics" checked>
                        Enable Physics
                    </label>
                    <label>
                        <input type="checkbox" id="show-edge-labels" checked>
                        Show Edge Labels
                    </label>
                    <label>
                        <input type="checkbox" id="combine-edges" title="Combine multiple edges with the same operation between the same source and destination nodes. Shows count and merged metadata.">
                        Combine Same Operations
                    </label>
                </div>
            </div>
            
            <h3>üéÆ Interaction Guide</h3>
            <div class="filter-section">
                <div style="font-size: 12px; color: #666; line-height: 1.4;">
                    <div style="margin-bottom: 8px;"><strong>Mouse:</strong></div>
                    <div>‚Ä¢ Click nodes/edges to see details on right</div>
                    <div>‚Ä¢ Click empty space to hide details</div>
                    <div>‚Ä¢ Drag nodes to reposition (stays fixed)</div>
                    <div>‚Ä¢ Right-click for context menu & unfix options</div>
                    <div>‚Ä¢ Double-click to focus on node</div>
                    <div>‚Ä¢ Scroll to zoom in/out</div>
                    <div style="margin: 8px 0;"><strong>Keyboard:</strong></div>
                    <div>‚Ä¢ <code>Ctrl+F</code> - Fit all nodes</div>
                    <div>‚Ä¢ <code>Space</code> - Toggle physics</div>
                    <div>‚Ä¢ <code>Escape</code> - Close details panel</div>
                    <div>‚Ä¢ <code>Ctrl+R</code> - Redraw graph</div>
                    <div style="margin: 8px 0;"><strong>Node Positioning:</strong></div>
                    <div style="font-size: 11px; color: #888;">
                        ‚Ä¢ Dragged nodes stay in place automatically
                    </div>
                    <div style="font-size: 11px; color: #888;">
                        ‚Ä¢ Right-click ‚Üí "Unfix Node" to allow movement
                    </div>
                    <div style="font-size: 11px; color: #888;">
                        ‚Ä¢ Right-click ‚Üí "Unfix All Nodes" to reset all
                    </div>
                    <div style="margin: 8px 0;"><strong>Registry Paths:</strong></div>
                    <div style="font-size: 11px; color: #888;">
                        ‚Ä¢ Long registry paths are automatically shortened
                    </div>
                    <div style="font-size: 11px; color: #888;">
                        ‚Ä¢ Select node to see full path in details
                    </div>
                    <div style="font-size: 11px; color: #888;">
                        ‚Ä¢ Common prefixes shown as "~"
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Main visualization area -->
        <div class="main">
            <div id="graph-container">
                <div class="no-graph">
                    <h2>üîó Unified Log Entry Visualization</h2>
                    <p>Select an event graph from the dropdown to begin visualization</p>
                    <p style="margin-top: 10px; font-size: 14px; color: #888;">
                        Features: Entry-based navigation ‚Ä¢ Sequence pattern detection ‚Ä¢ REAPr analysis ‚Ä¢ Real-time filtering
                    </p>
                </div>
            </div>
            <div class="loading" id="loading" style="display: none;">
                <div class="loading-spinner"></div>
                <div>Loading graph data...</div>
            </div>
        </div>

        <!-- Node Details Panel -->
        <div class="details-panel" id="details-panel">
            <div class="details-header">
                <h3>üìÑ Node Details</h3>
                <button class="close-btn" id="close-details-btn">√ó</button>
            </div>
            <div class="details-content" id="details-content">
                <div class="no-selection">
                    <p>Click on a node to view its details</p>
                </div>
            </div>
        </div>
        
        <!-- Status bar -->
        <div class="status">
            <div class="status-left">
                <span id="status-text">Ready - Select a graph to begin</span>
            </div>
            <div class="status-right">
                <span id="performance-text">Performance: -</span>
                <span id="memory-text">Memory: -</span>
                <span id="filter-text">Filters: None</span>
            </div>
        </div>
    </div>
    
    <!-- Legend -->
    <div class="legend" id="legend">
        <h4>Sequence Patterns</h4>
        <div id="legend-content"></div>
        <div class="legend-stats" id="legend-stats"></div>
    </div>
    
    <!-- Notification container -->
    <div id="notification" class="notification"></div>
    
    <script type="module" src="js/app.js"></script>
</body>
</html>